<?php require_once __DIR__ . '/../src/config.php'; // Inicializar variables $error = ''; $success = ''; if ($_SERVER['REQUEST_METHOD'] === 'POST') { $name = trim($_POST['name'] ?? ''); $email = trim($_POST['email'] ?? ''); $password = $_POST['password'] ?? ''; $confirm = $_POST['confirm'] ?? ''; // Validación básica if ($name === '' || $email === '' || $password === '' || $confirm === '') { $error = "Por favor, completa todos los campos."; } elseif (!filter_var($email, FILTER_VALIDATE_EMAIL)) { $error = "El email no es válido."; } elseif (strlen($password) < 6) { $error = "La contraseña debe tener al menos 6 caracteres."; } elseif ($password !== $confirm) { $error = "Las contraseñas no coinciden."; } else { // Comprobar si el email ya existe $stmt = $pdo->prepare("SELECT id FROM users WHERE email = ?"); $stmt->execute([$email]); if ($stmt->fetch()) { $error = "Ya existe una cuenta con este email."; } else { // Registrar usuario $hash = password_hash($password, PASSWORD_DEFAULT); $stmt = $pdo->prepare("INSERT INTO users (name, email, password_hash) VALUES (?, ?, ?)"); $stmt->execute([$name, $email, $hash]); $_SESSION['user_id'] = $pdo->lastInsertId(); $success = "Registro completado con éxito. Redirigiendo..."; header("refresh:2;url=./dashboard.php"); } } } ?> <!doctype html> <html lang="es"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>Registro - MoodPlanned</title> </head> <body class="bg-light"> <div class="container py-5"> <div class="row justify-content-center"> <div class="col-md-6 col-lg-5"> <div class="card shadow-lg border-0 rounded-4"> <div class="card-body p-4"> <h3 class="text-center mb-4">Crear cuenta</h3> <!-- Mensajes --> <?php if ($error): ?> <div class="alert alert-danger"><?= htmlspecialchars($error) ?></div> <?php elseif ($success): ?> <div class="alert alert-success"><?= htmlspecialchars($success) ?></div> <?php endif; ?> <form method="POST" action=""> <div class="mb-3"> <label for="name" class="form-label">Nombre completo</label> <input type="text" class="form-control" id="name" name="name" required value="<?= htmlspecialchars($_POST['name'] ?? '') ?>"> </div> <div class="mb-3"> <label for="email" class="form-label">Correo electrónico</label> <input type="email" class="form-control" id="email" name="email" required value="<?= htmlspecialchars($_POST['email'] ?? '') ?>"> </div> <div class="mb-3"> <label for="password" class="form-label">Contraseña</label> <input type="password" class="form-control" id="password" name="password" required> </div> <div class="mb-3"> <label for="confirm" class="form-label">Confirmar contraseña</label> <input type="password" class="form-control" id="confirm" name="confirm" required> </div> <button type="submit" class="btn btn-primary w-100">Registrarse</button> </form> <div class="text-center mt-3"> <small>¿Ya tienes una cuenta? <a href="login.php" class="text-decoration-none">Inicia sesión</a></small> </div> </div> </div> </div> </div> </div> </body>